/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/
export default function(){return function(n){"use strict";var t=function(){this.buckets=new Map};t.prototype.add=function(n){var t=n>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&n))},t.prototype.has=function(n){var t=this.buckets.get(n>>5);return void 0!==t&&0!=(t&1<<(31&n))},t.prototype.serialize=function(){var n=[];return this.buckets.forEach((function(t,r){n.push((+r).toString(36)+":"+t.toString(36))})),n.join(",")},t.prototype.deserialize=function(n){var t=this;this.buckets.clear(),n.split(",").forEach((function(n){var r=n.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))}))};var r=Math.pow(2,8),e=r-1,o=~e;function i(n){var t=function(n){return n&o}(n).toString(16),e=function(n){return(n&o)+r-1}(n).toString(16);return"codepoint-index/plane"+(n>>16)+"/"+t+"-"+e+".json"}function a(n,t){var r=n&e,o=t.codePointAt(r/6|0);return 0!=((o=(o||48)-48)&1<<r%6)}function u(n,t){var r;(r=n,r.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(n){return n.split("-").map((function(n){return parseInt(n.trim(),16)}))}))).forEach((function(n){var r=n[0],e=n[1];void 0===e&&(e=r),t(r,e)}))}function f(n,t){u(n,(function(n,r){for(var e=n;e<=r;e++)t(e)}))}var s={},c={},v=new WeakMap,l="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(n){var r=v.get(n);return r||(r=new t,f(n.ranges,(function(n){return r.add(n)})),v.set(n,r)),r}var h,p=new Map;function g(n,t,r){return n[t]?t:n[r]?r:function(n){for(var t in n)return t}(n)}function w(n,t){var r=t;if(!n.includes(r)){r=1/0;for(var e=0;e<n.length;e++)Math.abs(n[e]-t)<Math.abs(r-t)&&(r=n[e])}return r}function y(n){return h||(h=new Set,f("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(n){h.add(n)}))),h.has(n)}return n.CodePointSet=t,n.clearCache=function(){s={},c={}},n.getFontsForString=function(n,t){void 0===t&&(t={});var r=t.lang;void 0===r&&(r="en");var e=t.category;void 0===e&&(e="sans-serif");var o=t.style;void 0===o&&(o="normal");var u=t.weight;void 0===u&&(u=400);var f=(t.dataUrl||l).replace(/\/$/g,""),v=new Map,h=new Uint8Array(n.length),b={},k={},m=new Array(n.length),A=new Map,M=!1;function j(n){var t=p.get(n);return t||(t=fetch(f+"/"+n).then((function(n){if(!n.ok)throw new Error(n.statusText);return n.json().then((function(n){if(!Array.isArray(n)||1!==n[0])throw new Error("Incorrect schema version; need 1, got "+n[0]);return n[1]}))})).catch((function(t){if(f!==l)return M||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+f+'", trying default CDN. '+t.message),M=!0),f=l,p.delete(n),j(n);throw t})),p.set(n,t)),t}for(var P=function(t){var r=n.codePointAt(t),e=i(r);m[t]=e,s[e]||A.has(e)||A.set(e,j(e).then((function(n){s[e]=n}))),r>65535&&(t++,S=t)},S=0;S<n.length;S++)P(S);return Promise.all(A.values()).then((function(){A.clear();for(var t=function(t){var o=n.codePointAt(t),i=null,u=s[m[t]],f=void 0;for(var v in u){var l=k[v];if(void 0===l&&(l=k[v]=new RegExp(v).test(r||"en")),l){for(var d in f=v,u[v])if(a(o,u[v][d])){i=d;break}break}}if(!i)n:for(var h in u)if(h!==f)for(var p in u[h])if(a(o,u[h][p])){i=p;break n}i||(console.debug("No font coverage for U+"+o.toString(16)),i="latin"),m[t]=i,c[i]||A.has(i)||A.set(i,j("font-meta/"+i+".json").then((function(n){c[i]=n}))),o>65535&&(t++,e=t)},e=0;e<n.length;e++)t(e);return Promise.all(A.values())})).then((function(){for(var t,r=null,i=0;i<n.length;i++){var a=n.codePointAt(i);if(r&&(y(a)||d(r).has(a)))h[i]=h[i-1];else{r=c[m[i]];var s=b[r.id];if(!s){var l=r.typeforms,p=g(l,e,"sans-serif"),k=g(l[p],o,"normal"),A=w(null===(t=l[p])||void 0===t?void 0:t[k],u);s=b[r.id]=f+"/font-files/"+r.id+"/"+p+"."+k+"."+A+".woff"}var M=v.get(s);null==M&&(M=v.size,v.set(s,M)),h[i]=M}a>65535&&(i++,h[i]=h[i-1])}return{fontUrls:Array.from(v.keys()),chars:h}}))},Object.defineProperty(n,"__esModule",{value:!0}),n}({})}
